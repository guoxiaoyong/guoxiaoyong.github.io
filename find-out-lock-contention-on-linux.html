<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Find out Lock Contention on Linux</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Xiaoyong's Blog </a></h1>
                <nav><ul>
                    <li><a href="/pages/welcome-to-xiaoyong-guos-homepage.html">Home</a></li>
                    <li><a href="/index.html">Blog</a></li>
                    <li><a href="/pages/projects.html">Projects</a></li>
                    <li><a href="/pages/about_xiaoyong_guo.html">About</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/find-out-lock-contention-on-linux.html" rel="bookmark"
           title="Permalink to Find out Lock Contention on Linux">Find out Lock Contention on Linux</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Wed 27 July 2016</span>

</footer><!-- /.post-info -->      <p>When testing a multi-threaded program, 
which use <code>lock</code> to protect its critical section,
you may want to know how often these threads are
contenting to gain the ownership of the lock.</p>
<p>A simple method is to use <code>strace</code>, </p>
<div class="highlight"><pre><span></span><span class="n">strace</span> <span class="o">-</span><span class="n">f</span> <span class="n">program</span>
</pre></div>


<p><code>strace</code> will list all the system calls.
Note that you must add the switch <code>-f</code> 
so that <code>strace</code> will also trace threads and child processes,
otherwise <code>strace</code> list system calls made by the main thread only.
Since pthread mutex is build on top of <code>futex</code>, by check the number of
<code>futex</code> system calls in the list, 
you can get the idea of whether the contention for lock is intense or not.
You can also list the system calls made by each thread 
in different files using <code>-o</code> and <code>-ff</code> switch:</p>
<div class="highlight"><pre><span></span><span class="n">strace</span> <span class="o">-</span><span class="n">o</span> <span class="n">result</span> <span class="o">-</span><span class="n">ff</span> <span class="n">program</span>
</pre></div>


<p>Context switches of a running program 
can be find out from the file <code>/proc/$pid/status</code></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://52.193.207.59/blog/">Leon's Blog</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://www.github.com/guoxiaoyong">github</a></li>
                            <li><a href="http://twitter.com">twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->


        <footer id="contentinfo" class="body">
           <p>guoxiaoyong@guoxiaoyong.com</p>
        </footer><!-- /#contentinfo -->

  <div style="margin:auto;display:inline-block;width:400px;text-align:center"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/7.js?i=5d2dt1ex4s6&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;sx=0" async="async"></script></div>


</body>
</html>